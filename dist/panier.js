!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";var r=document.querySelector(".menu__btn"),o=document.querySelector(".close"),a=document.getElementById("navpanel");r.addEventListener("click",(function(){a.classList.add("menu--active")})),o.addEventListener("click",(function(){a.classList.remove("menu--active")}));t.a=function(){var e=function(){var e=void 0!==window.pageXOffset,t="CSS1Compat"===(document.compatMode||"");return e?window.pageYOffset:t?document.documentElement.scrollTop:document.body.scrollTop},t=r.getBoundingClientRect(),n=document.querySelector(r.getAttribute("data-constraint")).getBoundingClientRect(),o=n.top+e()+n.height-t.height;window.addEventListener("scroll",(function(){e()>o?r.classList.add("menu__btn--solid"):r.classList.contains("menu__btn--solid")&&r.classList.remove("menu__btn--solid")}))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var r="http://localhost:3000",o=function(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(200===r.status?t(JSON.parse(r.responseText)):n(r))},r.open("GET",e,!0),r.send()}))}},,,function(e,t,n){"use strict";n.r(t);var r=n(1),o=n(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){if(null===sessionStorage.getItem("newOrder"))console.log("Pas de nouvelle commande à ajouter");else{var e=localStorage.length,t=sessionStorage.getItem("newOrder");localStorage.setItem(e,t),sessionStorage.removeItem("newOrder")}}();var i=function e(t,n,r,o){a(this,e),this.id=t,this.name=n,this.price=r,this.lenses=o},s=function e(t,n,r,o,i){a(this,e),this.id=t,this.name=n,this.lense=r,this.qte=o,this.price=i,this.subtotal=parseInt(this.qte)*parseInt(this.price)},l=[],c=[];function d(e,t){for(var n=0,r=0;r<e.length;r++)e[r]._id===t.split("_")[0]&&e[r].lense===t.split("_")[1]&&(n+=parseInt(e[r].qte));return n}Object(r.b)("http://localhost:3000/api/cameras/").then((function(e){return new Promise((function(t,n){for(var r=0;r<e.length;r++)for(var o=0;o<e[r].lenses.length;o++){var a=new i(e[r]._id+"_"+e[r].lenses[o],e[r].name,e[r].price,e[r].lenses);l.push(a)}t(l)})).then((function(){for(var e=[],t=0;t<localStorage.length;t++){var n=JSON.parse(localStorage.getItem(t));e.push(n)}(function(e){var t=e.length,n=e.length,r=e.length,o=[],a={};for(t=0;t<r;t++)a[e[t]._id+"_"+e[t].lense]=0;for(n in a)o.push(n);return o})(e).forEach((function(t){for(var n=0;n<l.length;n++)if(l[n].id===t){var r=new s(l[n].id.split("_")[0],l[n].name,l[n].id.split("_")[1],d(e,t),l[n].price);c.push(r)}}))})).then((function(){for(var e=0,t=0;t<c.length;t++){var n=document.getElementById("cart-tablebody"),r=document.createElement("tr");n.appendChild(r);var o=document.createElement("td"),a=document.createElement("td"),i=document.createElement("td"),s=document.createElement("td"),l=document.createElement("td");r.appendChild(o),r.appendChild(a),r.appendChild(i),r.appendChild(s),r.appendChild(l);var d=c[t];o.innerText=d.name,a.innerText=d.lense,i.innerText=d.price/100+" €",s.innerText=d.qte,l.innerText=d.subtotal/100+" €",e+=parseInt(d.subtotal/100),document.getElementById("subtt").innerText=e+" €",sessionStorage.setItem("total",e)}}))})).catch((function(e){console.error("erreur lors du chargement du panier.",e)}));document.getElementById("empty").addEventListener("click",(function(){localStorage.clear(),location.reload()}));var u=document.getElementById("main"),m=document.getElementById("form"),f=document.getElementById("firstname"),p=document.getElementById("lastname"),h=document.getElementById("address"),v=document.getElementById("city"),g=document.getElementById("email");document.getElementById("submit").addEventListener("click",(function(e){if(e.preventDefault(),console.log(m.checkValidity()),c.length<1)if(null===document.querySelector("aside")){var t=u.appendChild(document.createElement("aside"));t.classList.add("error","error__panier","error__panier--anim"),t.innerText="Votre panier est vide"}else{var n=document.querySelector("aside");u.removeChild(n),u.appendChild(n)}else if(!0===m.checkValidity()){for(var o={firstName:f.value,lastName:p.value,address:h.value,city:v.value,email:g.value},a=[],i=0;i<c.length;i++)a.push(c[i].id);(d={contact:o,products:a},new Promise((function(e,t){var n=new XMLHttpRequest;n.open("POST",r.a+"/api/cameras/order"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(d)),n.onreadystatechange=function(){if(4===n.readyState)if(201===n.status){var r=JSON.parse(this.responseText);console.log(r),e(r)}else t(n)}}))).then((function(e){window.location.href="confirm.html";var t=JSON.stringify(e);sessionStorage.setItem("myOrder",t),localStorage.clear()})).catch((function(e){console.error("Erreur lors de l'envoi des données: "+e)}))}else if(null===document.querySelector("aside")){var s=u.appendChild(document.createElement("aside"));s.classList.add("error","error__panier","error__panier--anim"),s.innerText="Veuillez vérifier votre saisie"}else{var l=document.querySelector("aside");u.removeChild(l),u.appendChild(l)}var d})),Object(o.a)()}]);
//# sourceMappingURL=panier.js.map