!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a}));var r="http://localhost:3000",o=function(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(200===r.status?t(JSON.parse(r.responseText)):n(r))},r.open("GET",e,!0),r.send()}))},a=function(e,t){return new Promise((function(n,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)if(201===o.status){var e=JSON.parse(this.responseText);console.log(e),n(e)}else r(o)},o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(t))}))}},function(e,t,n){"use strict";var r=document.querySelector(".menu__btn"),o=document.querySelector(".close"),a=document.getElementById("navpanel");r.addEventListener("click",(function(){a.classList.add("menu--active")})),o.addEventListener("click",(function(){a.classList.remove("menu--active")}));var i=function(){var e=void 0!==window.pageXOffset,t="CSS1Compat"===(document.compatMode||"");return e?window.pageYOffset:t?document.documentElement.scrollTop:document.body.scrollTop},l=r.getBoundingClientRect(),c=document.querySelector(r.getAttribute("data-constraint")).getBoundingClientRect(),s=c.top+i()+c.height-l.height,d=function(){i()>s?r.classList.add("menu__btn--solid"):r.classList.contains("menu__btn--solid")&&r.classList.remove("menu__btn--solid")};t.a=function(){window.addEventListener("scroll",d)}},,,,function(e,t,n){"use strict";n.r(t);var r=n(0);var o=function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.name=n,this.price=r,this.lenses=o};var a=function e(t,n,r,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.name=n,this.lense=r,this.qte=o,this.price=a,this.subtotal=parseInt(this.qte)*parseInt(this.price)};function i(e,t){for(var n=0,r=0;r<e.length;r++)e[r]._id===t.split("_")[0]&&e[r].lense===t.split("_")[1]&&(n+=parseInt(e[r].qte));return n}var l=n(1),c=r.a+"/api/cameras/",s=r.a+"/api/cameras/order",d=[],u=[],m=[],f=document.getElementById("firstname"),p=document.getElementById("lastname"),g=document.getElementById("address"),h=document.getElementById("city"),v=document.getElementById("email"),y=document.getElementById("submit");!function(){if(null===sessionStorage.getItem("newOrder"))console.log("Pas de nouvelle commande à ajouter");else{for(var e=0,t=0;t<localStorage.length;t++)e=localStorage.key(t)==="ori_"+localStorage.length?localStorage.length+1:localStorage.length;var n=sessionStorage.getItem("newOrder");localStorage.setItem("ori_"+e,n),sessionStorage.removeItem("newOrder")}}(),Object(r.b)(c).then((function(e){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].lenses.length;n++){var r=new o(e[t]._id+"_"+e[t].lenses[n],e[t].name,e[t].price,e[t].lenses);m.push(r)}return m})).then((function(e){for(var t=0;t<localStorage.length;t++)if(localStorage.key(t).startsWith("ori_")){var n=JSON.parse(localStorage.getItem(localStorage.key(t)));d.push(n)}return function(e){var t=e.length,n=e.length,r=e.length,o=[],a={};for(t=0;t<r;t++)a[e[t]._id+"_"+e[t].lense]=0;for(n in a)o.push(n);return o}(d).forEach((function(t){for(var n=0;n<e.length;n++)if(m[n].id===t){var r=new a(e[n].id.split("_")[0],e[n].name,e[n].id.split("_")[1],i(d,t),e[n].price);u.push(r)}})),u})).then((function(e){for(var t=0,n=0;n<e.length;n++){var r=e[n],o=document.getElementById("cart-tablebody"),a=document.createElement("tr"),i=document.createElement("td"),l=document.createElement("td"),c=document.createElement("td"),s=document.createElement("td"),d=document.createElement("td");o.appendChild(a),a.appendChild(i),a.appendChild(l),a.appendChild(c),a.appendChild(s),a.appendChild(d),i.innerText=r.name,l.innerText=r.lense,c.innerText=r.price/100+" €",s.innerText=r.qte,d.innerText=r.subtotal/100+" €",t+=parseInt(r.subtotal/100),document.getElementById("subtt").innerText=t+" €",sessionStorage.setItem("total",t)}})).catch((function(e){console.error("Erreur lors de la requête: ",e);var t=document.getElementById("main").appendChild(document.createElement("div"));t.classList.add("error","error__server"),t.innerText="Une erreur s'est produite lors du chargement des articles"})),y.addEventListener("click",(function(e){if(e.preventDefault(),!0===function(e){var t=document.getElementById("main"),n=document.getElementById("form");if(e.length<1)if(null===document.querySelector("aside")){var r=t.appendChild(document.createElement("aside"));r.classList.add("error","error__panier","error__panier--anim"),r.innerText="Votre panier est vide"}else{var o=document.querySelector("aside");t.removeChild(o),t.appendChild(o)}else{if(!0===n.checkValidity())return!0;if(null===document.querySelector("aside")){var a=t.appendChild(document.createElement("aside"));a.classList.add("error","error__panier","error__panier--anim"),a.innerText="Veuillez vérifier votre saisie"}else{var i=document.querySelector("aside");t.removeChild(i),t.appendChild(i)}}}(u)){for(var t={firstName:f.value,lastName:p.value,address:g.value,city:h.value,email:v.value},n=[],o=0;o<u.length;o++)n.push(u[o].id);var a={contact:t,products:n};Object(r.c)(s,a).then((function(e){window.location.href="confirm.html";var t=JSON.stringify(e);sessionStorage.setItem("myOrder",t),localStorage.clear()})).catch((function(e){console.error("Erreur lors de la requête: ",e);var t=document.getElementById("main").appendChild(document.createElement("div"));t.classList.add("error","error__server"),t.innerText="Une erreur s'est produite lors de l'envoi du formulaire"}))}})),document.getElementById("empty").addEventListener("click",(function(){try{for(var e=0;e<localStorage.length;e++)for(;localStorage.key(e).startsWith("ori_");)localStorage.removeItem(localStorage.key(e))}catch(e){console.log("il n'y a plus de commande 'ori_' dans le localStorage")}finally{location.reload()}})),Object(l.a)()}]);
//# sourceMappingURL=panier.js.map